/*
  * -------------------------------------------------
  *  Nextflow config file with environment modules for CAMP @ The Crick
  * -------------------------------------------------
  */

process {

  // Global process config
  executor = 'slurm'

  // Use/unuse appropriate module paths and purge modules
  beforeScript = { "source $baseDir/assets/crick-modulepath.sh && module purge" }

  // Environment modules and resource requirements
  $makeBWAindex.module = ['BWA/0.7.17-foss-2018a']
  $makeGenomeFilter.module = ['SAMtools/1.8-foss-2016b','BEDTools/2.27.1-foss-2016b']
  $makeBED12.module = ['Perl/5.24.0-foss-2016b']

  $fastqc.module = ['FastQC/0.11.7-Java-1.8.0_172']
  $trim_galore.module = ['Trim_Galore/0.4.4-foss-2016b']

  $bwa_aln_read1.module = ['BWA/0.7.17-foss-2018a']
  $bwa_aln_read2.module = ['BWA/0.7.17-foss-2018a']
  $bwa_sai_to_sam.module = ['BWA/0.7.17-foss-2018a']
  $bwa_bam.module = ['SAMtools/1.8-foss-2016b']

  $markdup.module = ['SAMtools/1.8-foss-2016b','picard/2.18.11-Java-1.8.0_172']
  $markdup_collectmetrics.module = ['R/3.5.1-foss-2016b-BABS','picard/2.18.11-Java-1.8.0_172']
  $filter_bam.module = ['BamTools/2.5.1-foss-2018a','SAMtools/1.8-foss-2016b']
  $rm_orphan.module = ['Pysam/0.9.1.4-foss-2016b-Python-2.7.12','SAMtools/1.8-foss-2016b']

  $merge_replicate.module = ['picard/2.18.11-Java-1.8.0_172','SAMtools/1.8-foss-2016b']
  $replicate_name_bam.module = ['SAMtools/1.8-foss-2016b']
  $replicate_bigwig.module = ['BEDTools/2.27.1-foss-2016b','Kent_tools/20161115-linux.x86_64']
  $replicate_macs.module = ['MACS2/2.1.1.20160309-foss-2016b-Python-2.7.12','BEDTools/2.27.1-foss-2016b']
  $replicate_macs_annotate.module = ['Homer/4.10-Perl-5.26.1-foss-2018a']
  $replicate_macs_qc.module = ['R/3.5.1-foss-2016b-BABS']
  $replicate_macs_merge.module = ['Python/2.7.15-foss-2018a','BEDTools/2.27.1-foss-2016b','R/3.5.1-foss-2016b-BABS']
  $replicate_macs_merge_annotate.module = ['Homer/4.10-Perl-5.26.1-foss-2018a']
  $replicate_macs_merge_deseq.module = ['Subread/1.6.2','R/3.5.1-foss-2016b-BABS']

  $merge_sample.module = ['picard/2.18.11-Java-1.8.0_172','SAMtools/1.8-foss-2016b']
  $sample_bigwig.module = ['BEDTools/2.27.1-foss-2016b','Kent_tools/20161115-linux.x86_64']
  $sample_macs.module = ['MACS2/2.1.1.20160309-foss-2016b-Python-2.7.12','BEDTools/2.27.1-foss-2016b']
  $sample_macs_annotate.module = ['Homer/4.10-Perl-5.26.1-foss-2018a']
  $sample_macs_qc.module = ['R/3.5.1-foss-2016b-BABS']
  $sample_macs_merge.module = ['Python/2.7.15-foss-2018a','BEDTools/2.27.1-foss-2016b','R/3.5.1-foss-2016b-BABS']
  $sample_macs_merge_annotate.module = ['Homer/4.10-Perl-5.26.1-foss-2018a']
  $sample_macs_merge_deseq.module = ['Subread/1.6.2','R/3.5.1-foss-2016b-BABS']

  $multiqc.module = ['MultiQC/1.6-Python-2.7.15-foss-2018a']
  $igv.module = ['Python/2.7.15-foss-2018a']
  $output_documentation.module = ['R/3.5.1-foss-2016b-BABS']

  $get_software_versions.module = [
    'FastQC/0.11.7-Java-1.8.0_172',
    'BWA/0.7.17-foss-2018a',
    'SAMtools/1.8-foss-2016b',
    'BEDTools/2.27.1-foss-2016b',
    'BamTools/2.5.1-foss-2018a',
    'picard/2.18.11-Java-1.8.0_172',
    'R/3.5.1-foss-2016b-BABS',
    'Pysam/0.9.1.4-foss-2016b-Python-2.7.12',
    'Kent_tools/20161115-linux.x86_64',
    'MACS2/2.1.1.20160309-foss-2016b-Python-2.7.12',
    'Homer/4.10-Perl-5.26.1-foss-2018a',
    'Subread/1.6.2',
    'MultiQC/1.6-Python-2.7.15-foss-2018a'
  ]

}

params {

  // Max resources requested by a normal node on milou. If you need more memory, run on a fat node using:
  //   --clusterOptions "-C mem512GB" --max_memory "512GB"
  max_memory = 128.GB
  max_cpus = 16
  max_time = 72.h
  // illumina iGenomes reference file paths on CAMP @ The Francis Crick Institute
  igenomes_base = '/camp/svc/reference/Genomics/iGenomes/'
}
